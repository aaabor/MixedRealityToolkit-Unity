# [Template] Common build tasks shared between CI builds and PR validation.

steps:
# Build Standalone x86.
# This must happen before tests run, because if the build fails and tests attempt
# to get run, Unity will hang showing a dialog (even when in batch mode).
# This is the fastest build, since it doesn't produce an AppX.
- template: tasks/unitybuild.yml
  parameters:
    Arch: 'x86'
    Platform: 'Standalone'

# Tests should run earlier in the process, so that engineers can get test failure
# notifications earlier in the CI process.
- template: tests.yml

- template: generateprojects.yml

- task: MSBuild@1
  inputs:
    solution: '$(Build.SourcesDirectory)\MSBuild\Projects\MRTK.sln'
    msbuildArchitecture: 'x64'
    platform: 'WindowsStandalone32'
    configuration: 'InEditor'
    createLogFile: true
    restoreNugetPackages: true
  displayName: 'Build InEditor WindowsStandalone32'

- task: MSBuild@1
  inputs:
    solution: '$(Build.SourcesDirectory)\MSBuild\Projects\MRTK.sln'
    msbuildArchitecture: 'x64'
    platform: 'WindowsStandalone32'
    configuration: 'Player'
    createLogFile: true
    restoreNugetPackages: true
  displayName: 'Build Player WindowsStandalone32'

- task: MSBuild@1
  inputs:
    solution: '$(Build.SourcesDirectory)\MSBuild\Projects\MRTK.sln'
    msbuildArchitecture: 'x64'
    platform: 'WSA'
    configuration: 'Player'
    createLogFile: true
    restoreNugetPackages: true
  displayName: 'Build Player WSA'

- template: assetretargeting.yml
